"use strict";!function(){var a=Object.create(HTMLElement.prototype);a.addTag=function(a){var b=this.isDuplicate(a);return this.allowDuplicates||!b?(this.value.push(a),this.tagList.appendChild(this.createTag(a)),this.triggerEvent("add",a),this.log("groupCollapsed","adding tag"),this.log("added tag:",a),this.log("groupEnd"),!0):(this.handleDuplicate(),!1)},a.attachedCallback=function(){this.log("tags-input attached!",this)},a.attributeChangedCallback=function(a,b,c){var d=null;switch(this.log("groupCollapsed","attribute changed"),this.log("attribute:",a),a){case"data-duplicates":d="allowDuplicates";break;case"data-multiple":d="allowMultiple";break;case"data-new":d="allowNew";break;case"data-debug":d="debug"}d&&(this.updateAttribute(a,d),this.log("prop:",d)),this.log("old value:",b),this.log("new value:",c),this.log("groupEnd")},a.blurOption=function(a){a.classList.remove("focus")},a.blurTag=function(a){a.classList.remove("focus")},a.clearInput=function(){this.input.value=""},a.clearOptions=function(){this.optionList.innerHTML=""},a.clearSelectedTag=function(){var a=this.tagList.querySelector(".focus");a&&this.blurTag(a)},a.createdCallback=function(){this.initializeStickit(),this.updateAttribute("data-duplicates","allowDuplicates"),this.updateAttribute("data-multiple","allowMultiple"),this.updateAttribute("data-new","allowNew"),this.updateAttribute("data-debug","debug"),this.identifier=this.getAttribute("id")||this.getAttribute("name"),this.log("groupCollapsed","tags-input"),this.log("Allow Duplicates:",this.allowDuplicates),this.log("Allow Multiple:",this.allowMultiple),this.log("Allow New:",this.allowNew),this.log("Debug:",this.debug),this.log("groupEnd"),this.value=[],this.optionList=document.createElement("ol"),this.tagList=document.createElement("ul");var a=this.getAttribute("value");a&&a.split(",").forEach(this.addTag.bind(this)),this.optionList.classList.add("options"),this.tagList.classList.add("tags"),this.hideOptions(),this.createShadowRoot(),this.shadowRoot.appendChild(this.createStylesheet()),this.shadowRoot.appendChild(this.tagList),this.shadowRoot.appendChild(this.createInput()),this.shadowRoot.appendChild(this.optionList)},a.createInput=function(){var a=this;return this.input=document.createElement("input"),this.input.setAttribute("type","search"),this.input.addEventListener("keydown",this.handleKeybinds.bind(this)),this.input.addEventListener("input",this.handleInput.bind(this)),this.input.addEventListener("focus",function(){a.setAttribute("data-focus",""),a.showOptions()}),this.input.addEventListener("blur",function(){a.removeAttribute("data-focus"),a.hideOptions()}),this.input},a.createOption=function(a){var b=document.createElement("li");return"string"==typeof a?(b.innerHTML=a,b.setAttribute("data-value",a)):(b.innerHTML=a.value,b.setAttribute("data-value",a.value),a.id&&b.setAttribute("data-id",a.id)),b.addEventListener("mouseover",this.focusOption.bind(this,b)),b.addEventListener("mouseout",this.blurOption.bind(this,b)),b},a.createRemoveButton=function(a){var b=document.createElement("button");return b.innerHTML="&times;",b.addEventListener("mousedown",this.removeTag.bind(this,a)),b},a.createStylesheet=function(){var a=document.createElement("style");return a.innerHTML=":host {align-content: stretch;align-items: center;background-color: white;border: 1px solid black;display: flex;flex-wrap: wrap;position: relative;}:host input {border: none;flex-grow: 1;flex-shrink: 0;min-width: 20%;outline: none;padding: 1rem 1.5rem;}:host button {background: none;background-color: rgba(0, 0, 0, 0);border: none;border-radius: 0;flex-grow: 1;margin: 0;margin-left: 0.5rem;padding: 0 0.5rem;}:host button:hover {background-color: rgba(0, 0, 0, 0.3);}:host .options,:host .tags {list-style: none;margin: 0;padding: 0;}:host .options {background-color: white;border: 1px solid black;left: 0;position: absolute;right: 0;top: 100%;width: 100%;z-index: 1;}:host .options:empty {display: none;}:host .options li {padding: 1rem;}:host .options .focus {background-color: lightgrey;}:host .tags {align-items: center;display: flex;flex-wrap: wrap;flex-shrink: 0;max-width: 100%;}:host .tags li {background-color: lightgrey;margin: 0.5rem;padding: 0 0 0 0.5rem;}:host .tags .focus {background-color: blue;color: white;}:host .hide {display: none;}",a},a.createTag=function(a){var b=document.createElement("li");return"string"==typeof a?b.setAttribute("data-value",a):(b.setAttribute("data-value",a.value),a.id&&b.setAttribute("data-id",a.id)),b.appendChild(this.createTextWrapper(a)),b.appendChild(this.createRemoveButton(b)),b},a.createTextWrapper=function(a){var b=document.createElement("span");return"string"==typeof a?b.innerHTML=a:b.innerHTML=a.value,b},a.detachedCallback=function(){this.log("tags-input detached!",this)},a.findOption=function(a){var b=void 0;return b="string"==typeof a?"[data-value="+a+"]":a.id?"[data-id='"+a.id+"']":"[data-value='"+a.value+"']",this.optionList.querySelector(b)},a.focusOption=function(a){var b=this.optionList.querySelector(".focus"),c=this.tagList.querySelector(".focus");b&&this.blurOption(b),c&&this.blurTag(c),a.classList.add("focus")},a.focusTag=function(a){var b=this.tagList.querySelector(".focus");b&&this.blurTag(b),a.classList.add("focus")},a.getElementValue=function(a){return a.hasAttribute("data-id")?{id:a.getAttribute("data-id"),value:a.getAttribute("data-value")}:a.getAttribute("data-value")},a.handleDuplicate=function(){this.triggerEvent("error","duplicate"),this.log("warn","duplicate tag")},a.handleInvalid=function(){this.triggerEvent("error","invalid"),this.log("warn","invalid tag")},a.handleDelete=function(){if(this.shouldCaptureKeybind()){event.preventDefault();var a=this.tagList.querySelector(".focus");if(a){var b=a.previousElementSibling;b&&this.focusTag(b),this.removeTag(a)}else(a=this.tagList.querySelector("li:last-of-type"))&&this.focusTag(a)}},a.handleDownArrow=function(){event.preventDefault();var a=this.optionList.querySelector(".focus");if(a){var b=a.nextElementSibling;b&&(this.blurOption(a),this.focusOption(b))}else a=this.optionList.querySelector("li:first-of-type"),a&&this.focusOption(a)},a.handleInput=function(){this.clearSelectedTag(),this.search(this.input.value)},a.handleLeftArrow=function(){if(this.shouldCaptureKeybind()){event.preventDefault();var a=this.tagList.querySelector(".focus");if(a){var b=a.previousElementSibling;b&&(this.clearSelectedTag(),this.focusTag(b))}else a=this.tagList.querySelector("li:last-of-type"),a&&this.focusTag(a)}},a.handleKeybinds=function(a){switch(a.which){case 9:case 13:case 188:this.handleReturn(a);break;case 8:case 46:this.handleDelete();break;case 37:this.handleLeftArrow();break;case 39:this.handleRightArrow();break;case 38:this.handleUpArrow();break;case 40:this.handleDownArrow()}},a.handleOptionClick=function(a){a.preventDefault();var b=a.target,c=this.getElementValue(b);this.addTag(c)&&(this.clearInput(),this.clearOptions()),this.input.focus(),this.log("groupCollapsed","handleOptionClick"),this.log("value",c),this.log("target",b),this.log(this.input),this.log("groupEnd")},a.handleReturn=function(a){var b=this.optionList.querySelector("li:first-of-type"),c=this.optionList.querySelector(".focus"),d=void 0;if(this.input.value)return this.allowNew?d=this.input.value:b&&(d=this.getElementValue(b)),c&&(d=this.getElementValue(c)),this.allowNew||b?void(d&&(a.preventDefault(),this.addTag(d),this.clearInput(),this.clearOptions())):void this.handleInvalid()},a.handleRightArrow=function(){if(this.shouldCaptureKeybind()){event.preventDefault();var a=this.tagList.querySelector(".focus");if(a){var b=a.nextElementSibling;b&&this.focusTag(b),this.clearSelectedTag()}}},a.handleUpArrow=function(){event.preventDefault();var a=this.optionList.querySelector(".focus");if(a){var b=a.previousElementSibling;b&&this.focusOption(b),this.blurOption(a)}},a.hideOptions=function(){this.optionList.classList.add("hide")},a.initializeStickit=function(){var a=this;window.Backbone&&window.Backbone.Stickit&&Backbone.Stickit.addHandler({events:["blur"],getVal:function(a,b,c){return a.val()},onGet:function(b,c){return b&&(Array.isArray(b)?b.forEach(a.addTag):"string"==typeof b&&b.split(",").forEach(a.addTag.bind(a))),b},selector:"tags-input"})},a.isDuplicate=function(a){var b=void 0;return b="string"==typeof a?this.value.indexOf(a)!==-1:this.matchValue(a)!==-1},a.log=function(){var a="log";Object.keys(console).indexOf(arguments[0])!==-1&&(a=[].shift.call(arguments)),this.debug&&console[a].apply(this,arguments)},a.matchValue=function(a){for(var b=0,c=this.value.length;b<c;b++)if(this.value[b].id&&a.id){if(this.value[b].id===a.id)return b}else if(this.value[b].value===a.value)return b;return-1},a.removeTag=function(a){var b=this.getElementValue(a),c=void 0;"string"==typeof b?c=this.value.indexOf(b):this.matchValue(b),this.value.splice(c,1),a.querySelector("button").removeEventListener("mousedown",this.removeTag),a.remove(),this.triggerEvent("remove",b),this.log("groupCollapsed","removing tag"),this.log("value:",b),this.log("groupEnd")},a.search=function(a){a&&this.triggerEvent("search",a),this.log("groupCollapsed","search"),this.log(a?"query:"+a:"no query"),this.log("groupEnd")},a.shouldCaptureKeybind=function(){var a=this.input;return!a.selectionStart&&!a.selectionEnd},a.showOptions=function(){this.optionList.classList.remove("hide")},a.triggerEvent=function(a,b){this.dispatchEvent(new CustomEvent(a,{detail:b}))},a.updateAttribute=function(a,b){var c=this.hasAttribute(a),d=this.getAttribute(a);c?"string"==typeof d&&""===d&&(d=!0):d=!1,"string"==typeof d&&/(true|false)/gi.test(d)&&(d="true"===d.toLowerCase()),this[b]=d},a.updateOptions=function(a,b){var c=this;b||this.clearOptions(),a.forEach(function(a){if(!b||!c.findOption(a)){var d=c.createOption(a);d.addEventListener("mousedown",c.handleOptionClick.bind(c)),c.optionList.appendChild(d)}}),this.log("groupCollapsed","updating options"),this.log("options:",a),this.log("groupEnd")},document.registerElement("tags-input",{prototype:a})}();